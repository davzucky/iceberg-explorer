{
  "project": "Iceberg Explorer",
  "branchName": "ralph/iceberg-explorer-foundation",
  "description": "High-performance web application for interactive exploration of Apache Iceberg data lakes. Built with FastAPI, HTMX, Alpine.js, and DuckDB.",
  "userStories": [
    {
      "id": "US-001",
      "title": "Project Setup and Configuration",
      "description": "As a developer, I want a properly structured Python project with modern tooling so I can start building features.",
      "acceptanceCriteria": [
        "Configure pyproject.toml with FastAPI, DuckDB, Granian dependencies",
        "Set up source code in src/iceberg_explorer/ structure",
        "Configure pre-commit hooks (ruff, pyupgrade)",
        "Project uses uv for dependency management",
        "uv run pytest runs successfully",
        "uv run ruff check src/ passes",
        "Typecheck passes"
      ],
      "priority": 1,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-002",
      "title": "Configuration System",
      "description": "As a developer, I want a flexible configuration system so I can run the app in different environments.",
      "acceptanceCriteria": [
        "Load config from JSON file via ICEBERG_EXPLORER_CONFIG env var",
        "Support env var overrides (e.g., ICEBERG_EXPLORER_QUERY__MAX_ROWS)",
        "Create Pydantic models for config validation",
        "Support both REST and local catalog types",
        "Add configuration for DuckDB memory/threads limits",
        "Defaults for all optional settings",
        "Tests cover config loading and validation",
        "uv run pytest passes",
        "Typecheck passes"
      ],
      "priority": 2,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-003",
      "title": "DuckDB Engine Initialization",
      "description": "As a developer, I want a DuckDB engine that connects to Iceberg catalogs so I can query data.",
      "acceptanceCriteria": [
        "Create DuckDB connection pool/manager class",
        "Attach Iceberg catalog (REST or local) on initialization",
        "Enforce read-only mode at DuckDB level",
        "Make memory limit and thread count configurable",
        "Add health check method to verify catalog connectivity",
        "Unit tests with local Iceberg catalog fixture",
        "uv run pytest passes",
        "uv run ruff check src/ passes",
        "Typecheck passes"
      ],
      "priority": 3,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-004",
      "title": "Query Execution Engine",
      "description": "As a developer, I want a query executor that runs SQL and streams results so users can explore data.",
      "acceptanceCriteria": [
        "Execute SQL query with configurable timeout (10s - 3600s)",
        "Return results as Arrow batches for streaming",
        "Reject non-SELECT statements (INSERT, UPDATE, DELETE, DROP)",
        "Track execution metrics (duration, rows scanned)",
        "Implement query cancellation via interrupt",
        "Integration tests with sample Iceberg tables",
        "uv run pytest passes",
        "Typecheck passes"
      ],
      "priority": 4,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-005",
      "title": "List Namespaces Endpoint",
      "description": "As a user, I want to list namespaces so I can browse the data lake structure.",
      "acceptanceCriteria": [
        "GET /api/v1/catalog/namespaces returns top-level namespace list",
        "GET /api/v1/catalog/namespaces?parent={ns} returns child namespaces",
        "Parent parameter uses unit separator (%1F) for multi-level",
        "Namespaces returned as arrays",
        "Support pagination with page-token and page-size params",
        "Return 404 if parent namespace doesn't exist",
        "Empty list for catalogs with no namespaces",
        "Integration test with nested namespace hierarchy",
        "uv run pytest passes",
        "Typecheck passes"
      ],
      "priority": 5,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-006",
      "title": "List Tables Endpoint",
      "description": "As a user, I want to list tables in a namespace so I can see available data.",
      "acceptanceCriteria": [
        "GET /api/v1/catalog/namespaces/{namespace}/tables returns table list",
        "Namespace path uses unit separator for multi-level",
        "Return table identifiers as {namespace: [...], name: \"table_name\"}",
        "Return 404 for non-existent namespace",
        "Integration test with sample tables",
        "uv run pytest passes",
        "Typecheck passes"
      ],
      "priority": 6,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-007",
      "title": "Table Details Endpoint",
      "description": "As a user, I want to view table metadata so I can understand the table structure.",
      "acceptanceCriteria": [
        "GET /api/v1/catalog/tables/{namespace}.{table} returns details",
        "Include: location, format, partition spec, sort order, current snapshot",
        "Return snapshot history (list of snapshots with timestamps)",
        "Return 404 for non-existent table",
        "Integration test verifying all metadata fields",
        "uv run pytest passes",
        "Typecheck passes"
      ],
      "priority": 7,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-008",
      "title": "Table Schema Endpoint",
      "description": "As a user, I want to view table schema so I can understand column types.",
      "acceptanceCriteria": [
        "GET /api/v1/catalog/tables/{namespace}.{table}/schema returns schema",
        "Include column name, type, field ID, nullable flag",
        "Mark partition columns with indicator",
        "Include column statistics if available (min/max/null count)",
        "Integration test with various column types",
        "uv run pytest passes",
        "Typecheck passes"
      ],
      "priority": 8,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-009",
      "title": "Execute Query Endpoint",
      "description": "As a user, I want to execute SQL queries so I can explore data.",
      "acceptanceCriteria": [
        "POST /api/v1/query/execute accepts SQL and optional timeout",
        "Return query_id for tracking",
        "Validate SQL is SELECT-only before execution",
        "Default timeout 300s, user can specify 10s-3600s",
        "Return error with message for invalid queries",
        "Unit tests for SQL validation",
        "Integration tests for execution",
        "uv run pytest passes",
        "Typecheck passes"
      ],
      "priority": 9,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-010",
      "title": "Query Results Endpoint (Streaming)",
      "description": "As a user, I want to retrieve query results with pagination so I can view large datasets.",
      "acceptanceCriteria": [
        "GET /api/v1/query/{query_id}/results streams JSON lines",
        "Stream format: metadata -> data batches -> progress -> complete",
        "Support page_size param (100, 250, 500, 1000)",
        "Support offset param for pagination",
        "Include execution metrics in complete message",
        "Integration test verifying streaming behavior",
        "uv run pytest passes",
        "Typecheck passes"
      ],
      "priority": 10,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-011",
      "title": "Query Status Endpoint",
      "description": "As a user, I want to check query status so I know when results are ready.",
      "acceptanceCriteria": [
        "GET /api/v1/query/{query_id}/status returns current state",
        "States: pending, running, completed, failed, cancelled",
        "Include progress info for running queries (rows processed)",
        "Include error message for failed queries",
        "Unit tests for state transitions",
        "uv run pytest passes",
        "Typecheck passes"
      ],
      "priority": 11,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-012",
      "title": "Cancel Query Endpoint",
      "description": "As a user, I want to cancel running queries so I can stop long-running operations.",
      "acceptanceCriteria": [
        "POST /api/v1/query/{query_id}/cancel stops execution",
        "DuckDB query interrupted cleanly",
        "Status updates to cancelled",
        "Return success even if query already finished",
        "Integration test verifying cancellation works",
        "uv run pytest passes",
        "Typecheck passes"
      ],
      "priority": 12,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-013",
      "title": "CSV Export Endpoint",
      "description": "As a user, I want to export query results to CSV so I can use data in other tools.",
      "acceptanceCriteria": [
        "POST /api/v1/export/csv accepts query_id or inline SQL",
        "Stream CSV as chunked download",
        "Configurable max size (default 1GB)",
        "Proper Content-Disposition header with filename",
        "Handle large exports without memory issues",
        "Integration test with various data types",
        "uv run pytest passes",
        "Typecheck passes"
      ],
      "priority": 13,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-014",
      "title": "Base Layout and Navigation",
      "description": "As a user, I want a clean UI layout so I can navigate the application easily.",
      "acceptanceCriteria": [
        "Base HTML template with header, sidebar, main content",
        "Tailwind CSS for styling",
        "HTMX loaded for dynamic updates",
        "Alpine.js loaded for client-side interactivity",
        "Responsive design (works on tablet+)",
        "uv run ruff check src/ passes",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 14,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-015",
      "title": "Namespace Tree Browser",
      "description": "As a user, I want a sidebar namespace tree so I can browse the catalog structure.",
      "acceptanceCriteria": [
        "Sidebar shows namespace tree",
        "Click namespace to expand/collapse (lazy load via HTMX)",
        "Tables shown as leaf nodes under namespaces",
        "Click table to load details in main panel",
        "Loading indicator during fetch",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 15,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-016",
      "title": "Table Details View",
      "description": "As a user, I want to view table details so I can understand table metadata.",
      "acceptanceCriteria": [
        "Main panel shows selected table metadata",
        "Tabs for: Overview, Schema, Snapshots",
        "Overview: location, format, partitioning, current snapshot",
        "Schema: searchable column list with type badges",
        "Snapshots: list with timestamps",
        "HTMX partial updates when switching tabs",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 16,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-017",
      "title": "SQL Query Editor",
      "description": "As a user, I want a SQL editor so I can write and execute queries.",
      "acceptanceCriteria": [
        "Monaco editor with SQL syntax highlighting",
        "Run button executes query via HTMX",
        "Timeout selector (dropdown: 30s, 60s, 5m, 15m, 1h)",
        "Cancel button visible during execution",
        "Error messages displayed clearly",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 17,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-018",
      "title": "Query Results Table",
      "description": "As a user, I want to view query results in a table so I can explore data.",
      "acceptanceCriteria": [
        "Results displayed in scrollable table",
        "Column headers clickable for sorting (Alpine.js)",
        "Per-column filter inputs (text, numeric range)",
        "Pagination controls (page size selector, prev/next)",
        "Row count and execution time displayed",
        "Streaming indicator during data fetch",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 18,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-019",
      "title": "CSV Export Button",
      "description": "As a user, I want an export button so I can download results as CSV.",
      "acceptanceCriteria": [
        "Export button in results toolbar",
        "Shows progress for large exports",
        "Downloads file with appropriate name",
        "Disabled when no results available",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 19,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-020",
      "title": "Health and Readiness Endpoints",
      "description": "As an operator, I want health check endpoints so I can monitor the application.",
      "acceptanceCriteria": [
        "GET /health returns status, version, component health",
        "GET /ready returns readiness for traffic",
        "Check DuckDB connectivity in health",
        "Check catalog connectivity in health",
        "Return 503 if unhealthy",
        "Unit tests for health logic",
        "uv run pytest passes",
        "Typecheck passes"
      ],
      "priority": 20,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-021",
      "title": "OpenTelemetry Instrumentation",
      "description": "As an operator, I want observability via OpenTelemetry so I can monitor and debug the application.",
      "acceptanceCriteria": [
        "OpenTelemetry SDK integrated with auto-instrumentation",
        "FastAPI routes automatically traced",
        "DuckDB query spans with duration and row count attributes",
        "Metrics: query_duration_seconds, query_rows_returned, active_queries",
        "Configurable OTLP exporter endpoint",
        "Service name set to iceberg-explorer",
        "Structured JSON logs with trace context (trace_id, span_id)",
        "No sensitive data in logs (no SQL content by default)",
        "Integration test verifying traces and metrics are emitted",
        "uv run pytest passes",
        "Typecheck passes"
      ],
      "priority": 21,
      "passes": false,
      "notes": ""
    }
  ]
}
