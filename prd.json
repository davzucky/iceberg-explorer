{
  "title": "Iceberg Explorer - Data Lake Exploration Platform",
  "description": "High-performance web application for interactive exploration of Apache Iceberg data lakes. Built with FastAPI, HTMX, Alpine.js, and DuckDB.",
  "repoURL": "https://github.com/davzucky/iceberg-explorer",
  "phases": [
    {
      "name": "Phase 1: Project Foundation",
      "tasks": [
        {
          "id": "US-001",
          "title": "Project Setup and Configuration",
          "description": "Set up a properly structured Python project with modern tooling.\n\n**What to do:**\n- Configure `pyproject.toml` with FastAPI, DuckDB, Granian dependencies\n- Set up source code in `src/iceberg_explorer/` structure\n- Configure pre-commit hooks (ruff, pyupgrade)\n- Set up configuration loading from JSON file with env var overrides\n\n**Acceptance criteria:**\n- Project uses `uv` for dependency management\n- `uv run pytest` runs successfully (empty test suite)\n- `uv run ruff check src/` passes",
          "dependsOn": [],
          "passes": true
        },
        {
          "id": "US-002",
          "title": "Configuration System",
          "description": "Implement flexible configuration system for different environments.\n\n**What to do:**\n- Load config from JSON file via `ICEBERG_EXPLORER_CONFIG` env var\n- Support env var overrides (e.g., `ICEBERG_EXPLORER_QUERY__MAX_ROWS`)\n- Create Pydantic models for config validation\n- Support both REST and local catalog types\n- Add configuration for DuckDB memory/threads limits\n\n**Files:**\n- src/iceberg_explorer/config.py\n\n**Acceptance criteria:**\n- Defaults for all optional settings\n- Tests cover config loading and validation\n- `uv run pytest` passes",
          "dependsOn": ["US-001"],
          "passes": true
        }
      ]
    },
    {
      "name": "Phase 2: DuckDB Integration",
      "tasks": [
        {
          "id": "US-003",
          "title": "DuckDB Engine Initialization",
          "description": "Create DuckDB engine that connects to Iceberg catalogs.\n\n**What to do:**\n- Create DuckDB connection pool/manager class\n- Attach Iceberg catalog (REST or local) on initialization\n- Enforce read-only mode at DuckDB level\n- Make memory limit and thread count configurable\n- Add health check method to verify catalog connectivity\n\n**Files:**\n- src/iceberg_explorer/query/engine.py\n\n**Acceptance criteria:**\n- Unit tests with local Iceberg catalog fixture\n- `uv run pytest` passes\n- `uv run ruff check src/` passes",
          "dependsOn": ["US-002"],
          "passes": true
        },
        {
          "id": "US-004",
          "title": "Query Execution Engine",
          "description": "Build query executor that runs SQL and streams results.\n\n**What to do:**\n- Execute SQL query with configurable timeout (10s - 3600s)\n- Return results as Arrow batches for streaming\n- Reject non-SELECT statements (INSERT, UPDATE, DELETE, DROP)\n- Track execution metrics (duration, rows scanned)\n- Implement query cancellation via interrupt\n\n**Files:**\n- src/iceberg_explorer/query/executor.py\n- src/iceberg_explorer/query/models.py\n\n**Acceptance criteria:**\n- Integration tests with sample Iceberg tables\n- `uv run pytest` passes",
          "dependsOn": ["US-003"],
          "passes": true
        }
      ]
    },
    {
      "name": "Phase 3: Catalog API",
      "tasks": [
        {
          "id": "US-005",
          "title": "List Namespaces Endpoint",
          "description": "API endpoint to list namespaces for browsing data.\n\n**What to do:**\n- `GET /api/v1/catalog/namespaces` returns top-level namespace list\n- `GET /api/v1/catalog/namespaces?parent={ns}` returns child namespaces\n- Parent parameter uses unit separator (`%1F`) for multi-level: `parent=accounting%1Ftax`\n- Namespaces returned as arrays: `[[\"accounting\"], [\"engineering\"]]`\n- Support pagination with `page-token` and `page-size` params\n- Return 404 if parent namespace doesn't exist\n\n**Files:**\n- src/iceberg_explorer/api/routes/catalog.py\n- src/iceberg_explorer/models/catalog.py\n\n**Acceptance criteria:**\n- Empty list for catalogs with no namespaces\n- Integration test with nested namespace hierarchy\n- `uv run pytest` passes",
          "dependsOn": ["US-003"],
          "passes": true
        },
        {
          "id": "US-006",
          "title": "List Tables Endpoint",
          "description": "API endpoint to list tables in a namespace.\n\n**What to do:**\n- `GET /api/v1/catalog/namespaces/{namespace}/tables` returns table list\n- Namespace path uses unit separator for multi-level: `accounting%1Ftax`\n- Return table identifiers as `{namespace: [...], name: \"table_name\"}`\n- Return 404 for non-existent namespace\n\n**Files:**\n- src/iceberg_explorer/api/routes/catalog.py\n\n**Acceptance criteria:**\n- Integration test with sample tables\n- `uv run pytest` passes",
          "dependsOn": ["US-005"],
          "passes": true
        },
        {
          "id": "US-007",
          "title": "Table Details Endpoint",
          "description": "API endpoint to view table metadata.\n\n**What to do:**\n- `GET /api/v1/catalog/tables/{namespace}.{table}` returns details\n- Include: location, format, partition spec, sort order, current snapshot\n- Return snapshot history (list of snapshots with timestamps)\n- Return 404 for non-existent table\n\n**Files:**\n- src/iceberg_explorer/api/routes/catalog.py\n\n**Acceptance criteria:**\n- Integration test verifying all metadata fields\n- `uv run pytest` passes",
          "dependsOn": ["US-006"],
          "passes": true
        },
        {
          "id": "US-008",
          "title": "Table Schema Endpoint",
          "description": "API endpoint to view table schema.\n\n**What to do:**\n- `GET /api/v1/catalog/tables/{namespace}.{table}/schema` returns schema\n- Include column name, type, field ID, nullable flag\n- Mark partition columns with indicator\n- Include column statistics if available (min/max/null count)\n\n**Files:**\n- src/iceberg_explorer/api/routes/catalog.py\n\n**Acceptance criteria:**\n- Integration test with various column types\n- `uv run pytest` passes",
          "dependsOn": ["US-007"],
          "passes": true
        }
      ]
    },
    {
      "name": "Phase 4: Query API",
      "tasks": [
        {
          "id": "US-009",
          "title": "Execute Query Endpoint",
          "description": "API endpoint to execute SQL queries.\n\n**What to do:**\n- `POST /api/v1/query/execute` accepts SQL and optional timeout\n- Return query_id for tracking\n- Validate SQL is SELECT-only before execution\n- Default timeout 300s, user can specify 10s-3600s\n- Return error with message for invalid queries\n\n**Files:**\n- src/iceberg_explorer/api/routes/query.py\n- src/iceberg_explorer/models/query.py\n\n**Acceptance criteria:**\n- Unit tests for SQL validation\n- Integration tests for execution\n- `uv run pytest` passes",
          "dependsOn": ["US-004"],
          "passes": true
        },
        {
          "id": "US-010",
          "title": "Query Results Endpoint (Streaming)",
          "description": "API endpoint to retrieve query results with pagination.\n\n**What to do:**\n- `GET /api/v1/query/{query_id}/results` streams JSON lines\n- Stream format: metadata → data batches → progress → complete\n- Support `page_size` param (100, 250, 500, 1000)\n- Support `offset` param for pagination\n- Include execution metrics in complete message\n\n**Files:**\n- src/iceberg_explorer/api/routes/query.py\n\n**Acceptance criteria:**\n- Integration test verifying streaming behavior\n- `uv run pytest` passes",
          "dependsOn": ["US-009"],
          "passes": true
        },
        {
          "id": "US-011",
          "title": "Query Status Endpoint",
          "description": "API endpoint to check query status.\n\n**What to do:**\n- `GET /api/v1/query/{query_id}/status` returns current state\n- States: pending, running, completed, failed, cancelled\n- Include progress info for running queries (rows processed)\n- Include error message for failed queries\n\n**Files:**\n- src/iceberg_explorer/api/routes/query.py\n\n**Acceptance criteria:**\n- Unit tests for state transitions\n- `uv run pytest` passes",
          "dependsOn": ["US-009"]
        },
        {
          "id": "US-012",
          "title": "Cancel Query Endpoint",
          "description": "API endpoint to cancel running queries.\n\n**What to do:**\n- `POST /api/v1/query/{query_id}/cancel` stops execution\n- DuckDB query interrupted cleanly\n- Status updates to \"cancelled\"\n- Return success even if query already finished\n\n**Files:**\n- src/iceberg_explorer/api/routes/query.py\n\n**Acceptance criteria:**\n- Integration test verifying cancellation works\n- `uv run pytest` passes",
          "dependsOn": ["US-011"]
        }
      ]
    },
    {
      "name": "Phase 5: Export API",
      "priority": "lower",
      "tasks": [
        {
          "id": "US-013",
          "title": "CSV Export Endpoint",
          "description": "API endpoint to export query results to CSV.\n\n**Priority Note:** Lower priority, implement after core functionality.\n\n**What to do:**\n- `POST /api/v1/export/csv` accepts query_id or inline SQL\n- Stream CSV as chunked download\n- Configurable max size (default 1GB)\n- Proper Content-Disposition header with filename\n- Handle large exports without memory issues\n\n**Files:**\n- src/iceberg_explorer/api/routes/export.py\n\n**Acceptance criteria:**\n- Integration test with various data types\n- `uv run pytest` passes",
          "dependsOn": ["US-010"]
        }
      ]
    },
    {
      "name": "Phase 6: Web UI (HTMX + Alpine.js)",
      "tasks": [
        {
          "id": "US-014",
          "title": "Base Layout and Navigation",
          "description": "Create clean UI layout for application navigation.\n\n**What to do:**\n- Base HTML template with header, sidebar, main content\n- Tailwind CSS for styling (compiled, not CDN in prod)\n- HTMX loaded for dynamic updates\n- Alpine.js loaded for client-side interactivity\n- Responsive design (works on tablet+)\n\n**Files:**\n- src/iceberg_explorer/templates/base.html\n- static/css/\n- static/js/\n\n**Acceptance criteria:**\n- Verify in browser using dev-browser skill\n- `uv run ruff check src/` passes",
          "dependsOn": ["US-005"]
        },
        {
          "id": "US-015",
          "title": "Namespace Tree Browser",
          "description": "Sidebar namespace tree view for browsing.\n\n**What to do:**\n- Sidebar shows namespace tree\n- Click namespace to expand/collapse (lazy load via HTMX)\n- Tables shown as leaf nodes under namespaces\n- Click table to load details in main panel\n- Loading indicator during fetch\n\n**Files:**\n- src/iceberg_explorer/templates/partials/namespace_tree.html\n- src/iceberg_explorer/templates/catalog.html\n\n**Acceptance criteria:**\n- Verify in browser using dev-browser skill",
          "dependsOn": ["US-014"]
        },
        {
          "id": "US-016",
          "title": "Table Details View",
          "description": "Main panel view for table details.\n\n**What to do:**\n- Main panel shows selected table metadata\n- Tabs for: Overview, Schema, Snapshots\n- Overview: location, format, partitioning, current snapshot\n- Schema: searchable column list with type badges\n- Snapshots: list with timestamps\n- HTMX partial updates when switching tabs\n\n**Files:**\n- src/iceberg_explorer/templates/partials/table_details.html\n\n**Acceptance criteria:**\n- Verify in browser using dev-browser skill",
          "dependsOn": ["US-015", "US-008"]
        },
        {
          "id": "US-017",
          "title": "SQL Query Editor",
          "description": "SQL editor for writing and executing queries.\n\n**What to do:**\n- Monaco editor with SQL syntax highlighting\n- Run button executes query via HTMX\n- Timeout selector (dropdown: 30s, 60s, 5m, 15m, 1h)\n- Cancel button visible during execution\n- Error messages displayed clearly\n\n**Files:**\n- src/iceberg_explorer/templates/query.html\n\n**Acceptance criteria:**\n- Verify in browser using dev-browser skill",
          "dependsOn": ["US-014", "US-009"]
        },
        {
          "id": "US-018",
          "title": "Query Results Table",
          "description": "Table view for query results.\n\n**What to do:**\n- Results displayed in scrollable table\n- Column headers clickable for sorting (Alpine.js)\n- Per-column filter inputs (text, numeric range)\n- Pagination controls (page size selector, prev/next)\n- Row count and execution time displayed\n- Streaming indicator during data fetch\n\n**Files:**\n- src/iceberg_explorer/templates/partials/results_table.html\n\n**Acceptance criteria:**\n- Verify in browser using dev-browser skill",
          "dependsOn": ["US-017", "US-010"]
        },
        {
          "id": "US-019",
          "title": "CSV Export Button",
          "description": "Export button for downloading results as CSV.\n\n**Priority Note:** Lower priority, depends on US-013.\n\n**What to do:**\n- Export button in results toolbar\n- Shows progress for large exports\n- Downloads file with appropriate name\n- Disabled when no results available\n\n**Acceptance criteria:**\n- Verify in browser using dev-browser skill",
          "dependsOn": ["US-018", "US-013"]
        }
      ]
    },
    {
      "name": "Phase 7: Health & Observability",
      "tasks": [
        {
          "id": "US-020",
          "title": "Health and Readiness Endpoints",
          "description": "Health check endpoints for monitoring.\n\n**What to do:**\n- `GET /health` returns status, version, component health\n- `GET /ready` returns readiness for traffic\n- Check DuckDB connectivity in health\n- Check catalog connectivity in health\n- Return 503 if unhealthy\n\n**Files:**\n- src/iceberg_explorer/api/routes/health.py\n\n**Acceptance criteria:**\n- Unit tests for health logic\n- `uv run pytest` passes",
          "dependsOn": ["US-003"]
        },
        {
          "id": "US-021",
          "title": "OpenTelemetry Instrumentation",
          "description": "Observability via OpenTelemetry.\n\n**What to do:**\n- OpenTelemetry SDK integrated with auto-instrumentation\n- FastAPI routes automatically traced\n- DuckDB query spans with duration and row count attributes\n- Metrics: `query_duration_seconds`, `query_rows_returned`, `active_queries`\n- Configurable OTLP exporter endpoint\n- Service name set to `iceberg-explorer`\n- Structured JSON logs with trace context (trace_id, span_id)\n- No sensitive data in logs (no SQL content by default)\n\n**Acceptance criteria:**\n- Integration test verifying traces and metrics are emitted\n- `uv run pytest` passes",
          "dependsOn": ["US-020"]
        }
      ]
    }
  ],
  "nonGoals": [
    "Authentication/Authorization (Keycloak integration deferred to Phase 2)",
    "Query History (no persistent storage of past queries)",
    "Query Bookmarks (no saved queries feature)",
    "Parquet Export (CSV only for MVP)",
    "Multi-Catalog (single catalog per deployment)",
    "Write Operations (read-only access only)",
    "Time-Travel Queries (view snapshots but not query them)",
    "Data Profiling (no automatic statistics generation)",
    "Query Scheduling (no async/scheduled queries)",
    "Docker/Kubernetes (standalone Python first, containers later)",
    "Query Plan Visualization (EXPLAIN output deferred)"
  ],
  "technicalNotes": {
    "dependencies": [
      "FastAPI",
      "HTMX",
      "Alpine.js",
      "DuckDB (with Iceberg extension)",
      "Granian",
      "Pydantic",
      "Jinja2",
      "opentelemetry-instrumentation-fastapi",
      "opentelemetry-exporter-otlp",
      "structlog"
    ],
    "testingStrategy": {
      "unit": "70% - Config, models, SQL validation, query state",
      "integration": "20% - DuckDB queries, catalog operations, API endpoints",
      "e2e": "10% - Full user workflows with browser automation"
    },
    "performanceTargets": {
      "metadataOperations": "Sub-second",
      "queryExecution": "Within 5s for typical GB-scale queries",
      "streamingResultsStart": "Within 500ms of query completion",
      "uiInteractions": "<100ms feedback"
    }
  }
}
